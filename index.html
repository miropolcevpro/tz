<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0a0c10" />
  <title>AR мощение тротуарной плитки — Web MVP</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.webmanifest" />
</head>
<body>

  <div id="splash" class="splash">
    <div class="splashInner">
      <img class="splashLogo" src="assets/logo.png" alt="Логотип" />
      <div class="splashSpinner" aria-hidden="true"></div>
      <div class="splashText">Загрузка…</div>
    </div>
  </div>

  <canvas id="c"></canvas>

  <header class="topbar">
    <div class="title">AR мощение <span class="ver">Web MVP</span></div>
    <div id="status" class="status">инициализация…</div>
  </header>

  <section id="help" class="card help" role="dialog" aria-label="Подсказки">
    <div class="cardHead">
      <div class="cardTitle">Как пользоваться</div>
      <button id="closeHelp" class="iconBtn" aria-label="Скрыть подсказки">×</button>
    </div>
    <ol class="helpList">
      <li>Откройте сайт в <b>Chrome на Android</b> (нужен ARCore).</li>
      <li>Выберите плитку в каталоге → нажмите <b>Включить AR</b>.</li>
      <li>Наведите камеру на пол — появится маркер.</li>
            <li><b>Контур:</b> сначала нажмите <b>Калибр. пол</b>, затем тапайте по углам → <b>Замкнуть</b> → <b>Визуализировать</b>.</li>
      <li><b>Замер:</b> 2 тапа = расстояние, контур = площадь.</li>
    </ol>
    <div class="helpNote">
      iPhone/iPad: в Safari обычно нет WebXR «immersive-ar», поэтому будет только 3D‑превью (без привязки к полу).<br/>
      Админка каталога: <a href="./admin.html" target="_blank" rel="noopener">admin.html</a>
    </div>
  </section>

  <button id="menuFab" class="fab" aria-label="Открыть меню" title="Меню">☰</button>
  <button id="catalogFab" class="fab fab2" aria-label="Каталог" title="Каталог">▦</button>
  <button id="helpFab" class="fab fab3" aria-label="Подсказки" title="Подсказки">?</button>

  <section id="panel" class="panel">
    <div class="panelGrip" aria-hidden="true"></div>

    <div class="panelRow">
      <button id="enterArBtn" class="btn primary">Включить AR</button>
      <button id="exitArBtn" class="btn" disabled>Выход</button>
      <button id="clearBtn" class="btn">Очистить</button>
      <button id="calibBtn" class="btn">Калибр. пол</button>
      <button id="gridBtn" class="btn">Сетка</button>
      <button id="hidePanelBtn" class="btn ghost">Скрыть</button>
    </div>

    <div class="card compact">
      <div class="cardTitle">Режим</div>
      <div class="seg">        <button id="modeDraw" class="segBtn segOn">Контур</button>
        <button id="modeMeasure" class="segBtn">Замер</button>
      </div>
      <div class="note" id="modeHint">Контур: калибруйте пол, затем ставьте точки.</div>
    </div>

    <div class="card compact" id="drawCard" hidden>
      <div class="cardTitle">Разметка контура</div>
      <div class="note">1) Нажмите «Калибр. пол» (маркер должен быть на полу). 2) Тапайте точки (4–10). 3) Замкните контур — появится кнопка «Визуализировать».</div>
      <div class="panelRow small">
        <button id="undoBtn" class="btn">↶ Отмена</button>
        <button id="closePolyBtn" class="btn primary">Замкнуть контур</button>
        <button id="resetPolyBtn" class="btn">Очистить</button>
      </div>
      <div class="note" id="areaOut">—</div>
      <div class="note" id="drawStatus"></div>
    </div>

    <div class="card compact" id="measureCard" hidden>
      <div class="cardTitle">Замер</div>
      <div class="note">Тапните 2 точки на полу — покажем расстояние. В режиме «Контур» показываем площадь.</div>
      <div class="panelRow small">
        <button id="clearMeasureBtn" class="btn">Сбросить замер</button>
      </div>
      <div class="note" id="measureOut">—</div>
    </div>

    <div class="card compact">
      <div class="cardTitle">Плитка</div>
      <div class="note"><b id="tileName">—</b></div>
      <div id="variantRow" class="variantRow"></div>

      <label class="field">
        <span>Масштаб текстуры: <b id="texVal">1.00</b>x</span>
        <input id="texScale" type="range" min="0.25" max="3" step="0.05" value="1.00" />
      </label>

      <label class="field">
        <span>Высота (мм): <b id="hVal">-5</b></span>
        <input id="heightMm" type="range" min="-20" max="10" step="1" value="-5" />
      </label>

      <label class="field">
        <span>Раскладка</span>
        <select id="layout">
          <option value="straight">Прямая</option>
          <option value="diagonal">Диагональ 45°</option>
          <option value="cross">Поворот 90°</option>
          <option value="running">Смещение рядов</option>
        </select>
      </label>

      <div class="panelRow small">
        <button id="openCatalogBtn" class="btn">Открыть каталог</button>
        <button id="shotBtn" class="btn">Скриншот</button>
      </div>
    </div>

    <div class="note small muted">
      WebXR AR работает в Chrome на Android. Для iPhone нужна нативная версия (Unity/ARKit) или специальный WebXR Viewer.
    </div>
  </section>

  <div id="catalogOverlay" class="catalogOverlay hidden" aria-hidden="true">
    <div class="catalogModal">
      <div class="catalogHead">
        <div class="catalogTitle">Каталог плитки</div>
        <button id="closeCatalogBtn" class="iconBtn" aria-label="Закрыть каталог">×</button>
      </div>

      <div class="catalogControls">
        <input id="catalogSearch" class="search" type="search" placeholder="Поиск по названию…" />
        <div class="filters">
          <select id="filterCollection"><option value="">Коллекция (все)</option></select>
          <select id="filterTech"><option value="">Технология (все)</option></select>
          <select id="filterThickness"><option value="">Толщина (все)</option></select>
        </div>
        <div class="catalogHint">Нажмите на карточку, чтобы применить плитку.</div>
      </div>

      <div id="catalogGrid" class="catalogGrid"></div>
    </div>
  </div>


  <div id="actionBar" class="actionBar hidden" aria-live="polite">
    <button id="actionBtn" class="actionBtn">Визуализировать</button>
    <button id="actionClose" class="actionClose" aria-label="Скрыть">×</button>
  </div>
    <div class="panelRow statusRow">
      <div id="floorQualityBadge" class="badge bad" title="Качество трекинга пола">Floor: scanning…</div>
      <button id="occlusionToggle" class="btn small" aria-label="Toggle occlusion">Occlusion: Off</button>
    </div>


  <pre id="dbg" class="dbg" hidden></pre>

  <script type="module" src="app.js"></script>
</body>
</html>
