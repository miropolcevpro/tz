# AR мощение тротуарной плитки — Web MVP (GitHub Pages)

Это статический WebXR-проект для демонстрации AR-визуализации мощения:

- **Android (Chrome + ARCore):** WebXR `immersive-ar` + hit-test (привязка к полу).
- **iPhone/iPad:** WebXR AR обычно недоступен → показывается **3D‑превью** (без привязки к полу). Для iOS “как в приложении” нужен нативный ARKit/Unity или специальный WebXR Viewer.

## Что умеет

- Каталог плитки **карточками** (миниатюры) + фильтры.
- **Варианты цвета** (tint) по кнопкам‑свайчам.
- Режим **Place**: прямоугольная область мощения (ширина/длина, поворот, масштаб текстуры).
- Режим **Контур**: пользователь тапает углы на полу → строится многоугольник → заполняется плиткой.
- Режим **Замер**: 2 точки → расстояние, в режиме контура показывается площадь/периметр.
- **Service Worker**: оффлайн после первого посещения (кэширует файлы/текстуры, которые уже были загружены).

## Быстрый старт (GitHub Pages)

1) Создайте репозиторий, например `paver-ar-web`.
2) Загрузите **все файлы** из этого проекта в корень репозитория.
3) GitHub → **Settings → Pages**
   - Source: **Deploy from a branch**
   - Branch: `main` (или `master`) / root
4) Откройте: `https://<username>.github.io/<repo>/`

### Важно для AR
- Только **HTTPS** (GitHub Pages — ок).
- Открывайте в **Chrome на Android**.
- На Android должен быть установлен/обновлён **Google Play Services for AR (ARCore)**.

## Как добавить свои позиции плитки (100+)

### Вариант A (самый простой): через admin.html
1) Откройте `admin.html` на вашем домене GitHub Pages.
2) Нажмите `+ Добавить позицию`.
3) Добавьте варианты цвета (кнопка `+ Вариант цвета`).
4) Для каждого варианта выберите файлы (Base/Normal/Roughness/Thumb).
5) Нажмите **Скачать ZIP (json + файлы)**.
6) Распакуйте ZIP и **скопируйте** папку `catalog/` в репозиторий (с заменой файлов).
7) Сделайте commit/push.

### Вариант B: вручную
1) Создайте папку:
   - `catalog/tiles/<itemId>/<variantId>/`
2) Положите туда:
   - `base.png` (или .jpg)
   - `normal.png` (опционально)
   - `roughness.png` (опционально)
   - `thumb.jpg` (превью)
3) Добавьте запись в `catalog/catalog.json`.

## Советы по качеству визуализации
- Делайте **бесшовные** текстуры (seamless) — иначе повтор будет заметен.
- Для “суперкачества” используйте:
  - BaseColor 2048–4096
  - Normal 2048
  - Roughness 1024–2048
- Не ставьте слишком тяжёлые PNG на мобилках — JPEG/WebP часто быстрее.

## Где менять версию/настройки
- Основное приложение: `app.js`, `styles.css`, `index.html`
- Каталог: `catalog/catalog.json`
- Админка: `admin.html`, `admin.js`, `admin.css`



## Обновление: v6 (floor-lock стабилизация)

Ключевые исправления по проблемам “точки ставятся в пространстве / сетка рисуется везде / плывет”:

- При калибровке пола `lockedRoot` больше **не копирует наклон** поверхности из hit-test (фиксируем только позицию, ориентация горизонтальная).
- После калибровки hit-test принимает точки **только в допуске по высоте** от `floorY` (по умолчанию ±2 см), что защищает от стен/вертикалей.
- Сетка не вращается (GridHelper уже в XZ), `depthTest` включен.
- Скриншот: добавлен безопасный `toBlob()` + try/catch и временное скрытие UI.
- Service Worker cache version: `paver-ar-cache-v6` (для обновления при деплое).
